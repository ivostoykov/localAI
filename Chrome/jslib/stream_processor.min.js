const StreamMarkdownProcessor=function(){const e="*_`'#-+";var t="";function n(e){return e.removeAttribute("id"),(e=e.closest("#laiPreviousAiInput")).setAttribute("id","laiActiveAiInput"),e}function i(e){const t=e.tagName.toLowerCase();return"pre"===t?n(e):("code"===t&&(e=function(e){let t=e.innerHTML;const n=t.match(/^(`{1,3}|'{1,3}|~{1,3})/);n&&n[1]&&(t=t.replace(n[1],""));return(e=e.closest("#laiPreviousAiInput")).querySelector("#laiActiveAiInput").remove(),e.setAttribute("id","laiActiveAiInput"),e.innerHTML+=`${t}`,e}(e)),function(e){e.setAttribute("id","laiPreviousAiInput");const t=Object.assign(document.createElement("pre"),{id:"laiActiveAiInput",className:"lai-source",innerHTML:'<span class="lai-source-title">Code</span>\n'});return e.appendChild(t),e.querySelector("#laiActiveAiInput")}(e))}function r(r,c){let u=c.tagName.toLowerCase();r.split("").forEach((r=>{const s=r;let o=function(t,n,i){return""===n&&e.indexOf(t)>-1||!!(e.indexOf(n)>-1&&/\s/.test(t))||!!(/\s/.test(n)&&e.indexOf(t)>-1)||!(!/^h|pre/i.test(i)||"\n"!==t)||")"===n||"-"===n||!!/[`'][\s.,;:!?)\]}>]|[\s<({\[][`']/.test(n+t)||e.indexOf(n)>-1&&e.indexOf(t)>-1&&n===t}(r,t.slice(-1),u);if(o){let s=u;c.innerHTML=function(e){const t=e.tagName.toLowerCase();let n=e.innerHTML;return"code"===t?n:"pre"===t?n.replace(/[`']{1,}$/,""):/#\s/.test(n)?n:n.replace(/[`'#*_]{1,}$/,"")}(c),c=function(e,r){let c=r.tagName.toLowerCase();const u=t.slice(-4);if("h"===c.charAt(0)&&"\n"===e)return n(r);if("pre"!==c){let i=t.match(/\[(.*?)\]\((.*?)\)$/);if(i)return function(e,t){const n=`<a href="${t?.[2]||""}">${t?.[1]||""}</a>`;return e.innerHTML=e.innerHTML.replace(t[0],n),e}(r,i);if(/\n-{3,}\n$/.test(t+e))return r.innerHTML=r.innerHTML.replace(/-{1,}$/,"<hr>"),r;if(["b","strong","i","em"].includes(c)&&"*_".indexOf(e)<0&&"*_".indexOf(u.slice(-1))>-1)return n(r);if(!["b","strong","i","em"].includes(c)&&"*_".indexOf(e)>-1&&"*_".indexOf(u.slice(-1))<0)return function(e,t){return e.setAttribute("id","laiPreviousAiInput"),e.innerHTML+=`<i id="laiActiveAiInput" data-char="${t}"></i>`,e.querySelector("#laiActiveAiInput")}(r,e);if("i"===c&&e===u.slice(-1)&&"*_".indexOf(e)>-1)return function(e,t){let n=e.outerHTML,i=e.parentElement;return e.remove(),i.innerHTML+=n.replace(/^\<i/,"<b").replace(/i\>$/,"b>"),i.querySelector("#laiActiveAiInput")}(r);if(["b","strong","i","em"].includes(c))return r}if(/\n(`{3}|'{3})$/.test(u+e))return i(r);if("pre"!==c&&/\n?#{1,}[ \t]+$/.test(u+e))return function(e,t){const n=t.tagName.toLowerCase(),i=(e.match(/#+/)||[""])[0].length;if("h"!==n.charAt(0))return t.setAttribute("id","laiPreviousAiInput"),t.innerHTML+=`<h${i} id="laiActiveAiInput"></h${i}>`,t.querySelector("#laiActiveAiInput");if(n===`h${i}`)return t;const r=t.parentElement;return t.remove(),r.setAttribute("id","laiPreviousAiInput"),r.innerHTML+=`<h${i} id="laiActiveAiInput"></h${i}>`,r.querySelector("#laiActiveAiInput")}(t.slice(-8)+e,r);if("pre"!==c&&/[\n\s<({\[][`']/.test(u.slice(-1)+e))return function(e,t){return e.setAttribute("id","laiPreviousAiInput"),e.innerHTML+=`<code id="laiActiveAiInput" class="lai-code" data-char="${t}"></code>`,e.querySelector("#laiActiveAiInput")}(r,e);if("code"===c&&/[`'][\n\s.,;:!?)\]}>]/.test(u.slice(-1)+e)){const e=r.getAttribute("data-char")||"";return u.slice(-1)!==e?r:(r.removeAttribute("data-char"),r.innerHTML=r.innerHTML.replace(e,""),n(r))}return r}(r,c),u=c.tagName.toLowerCase(),s!==u&&e.indexOf(r)>-1&&(s=u,r="")}t+=s,"pre"===u&&"\n"===r&&(r=function(e,n){const i=t.split("\n")?.slice(-3).join("\n");let r=/(?:\n)(?:`{3}|'{3})([^\n]+)(?:\n)$/.exec(i)||[];if(r?.[1]){n.innerHTML=n.innerHTML.replace(new RegExp(r[1]+"$","ig"),"");const t=n.querySelector(".lai-source-title");t.innerHTML=t.innerHTML.replace(new RegExp("Code","gi"),r[1]),e=""}return e}(r,c)),c.innerHTML+="pre"===u?r:"\n"===r?"<br/>":r,c.innerHTML=c.innerHTML.replace(/<br\s*\/?>\s*<br\s*\/?>$/,"<p/>")}))}return{processStreamChunk:function(e,t){t&&("function"==typeof t&&(t=t()),t&&r(e,t))},dispose:function(){t=""},getRawContent:()=>t}}();